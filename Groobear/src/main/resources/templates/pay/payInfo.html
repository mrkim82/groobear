<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
 layout:decorate="~{layout/mailTiles}">
<head>
<meta charset="UTF-8">
<title>InProgressPay</title>
</head>
<body layout:fragment="content">
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
	<div style="width: 800px;">
		<table style="float:left; width: 400px;">
			<thead></thead>
			<tbody>
				<tr>
					<td>문서 번호 <input type="text" id="payNo" th:value="${list.payNo}" style="border:none" readonly></td>
				</tr>
				<tr>
					<td>작성자 [[${drafterInfo.name}]] [[${drafterInfo.rank}]] [[${drafterInfo.deptName}]]</td>
				</tr>
				<tr>
					<td>작성일자 <input type="text" id="issueDate" th:value="${#dates.format(list.issueDate,'yyyy-MM-dd')}" readonly style="border: none;"></td>
				</tr>
				<tr>
					<td id="sessionId" style="display: none;">[[${session.Id}]]</td>
				</tr>
				<tr>
					<td style="display:none"><input type="text" id="masterDocType" th:value="${list.docType}"></td>
				</tr>
				<tr>
					<td style="display:none"><input type="text" id="drafter" th:value="${drafterInfo.id}"></td>
				</tr>
				<tr>
					<td style="display:none"><input type="text" id="approver2" th:value="${list.approver2}"></td>
				</tr>
				<tr>
					<td style="display:none"><input type="text" id="approver3" th:value="${list.approver3}"></td>
				</tr>
				<tr>
					<td style="display:none"><input type="text" id="payStatus2" th:value="${list.payStatus2}"></td>
				</tr>
				<tr>
					<td style="display:none"><input type="text" id="payStatus3" th:value="${list.payStatus3}"></td>
				</tr>
			</tbody>
		</table>
		<table style="float:left; width: 380px;">
			<thead></thead>
			<tbody>
				<tr>
					<td>133333333333</td>
					<td>23333333333</td>
					<td>33333333333333333333333</td>
				</tr>
				<tr>
					<td>45555555555</td>
					<td>55555555555</td>
					<td>6555555555555555</td>
				</tr>
				<tr>
					<td>75555555555</td>
					<td>85555555555</td>
					<td>9555555555555555</td>
				</tr>
			</tbody>
		</table>
		<table style="float:left; width: 790px;">
			<thead></thead>
			<tbody>
				<th:block th:if="${list.docType=='a'}">
				<tr>
					<td style="display:none"><input type="text" id="laydocType" th:value="${list.docType}"></td>
				</tr>
				<tr>
					<td style="width: 300px;">사유 : <input type="text" id="purpose" th:value="${list.purpose}" readonly></td>
					<td style="width: 300px;">운행일자 : <input type="text" id="operDate" th:value="${#dates.format(list.operDate, 'yyyy-MM-dd')}" readonly></td>
				</tr> 
				<tr>
					<td>행선지 <input type="text" id="destination" th:value="${list.destination}"></td>
				</tr>
				<tr>
					<td>운행전 키로수 <input type="text" id="befored" th:value="${list.befored}" onchange="kmChange()"></td>
					<td>운행후 키로수 <input type="text" id="afterd" th:value="${list.afterd}" onchange="kmChange()"></td>
				</tr>
				<tr>
					<td>
						출자금 <input type="text" id="imprest" th:value="${list.imprest}" readonly>
					</td>
				</tr>
						<tr><td><div class="panel-body1">
	                        <div class="form-group uploadDiv1">
	                            <input name="uploadFile1" type="file" multiple>
	                        </div>
		                        <!-- foreach써서 조회하는걸로 변경 -->
								<div class="uploadResult0">
							       <ul th:each="pay : ${payImgInfo}">
									<li th:data-path="${pay.uploadPath}" th:data-uuid="${pay.uuid}"
									th:data-fileName="${pay.fileName}" data-type="true" style="list-style-type:none">
									<button type="button" id="logImgDel" onclick="payImgDel(this)">제거</button>
										<div>
											<img th:src="@{|/display?fileName=${#strings.replace(pay.uploadPath,'\','/')}/${pay.uuid}_${pay.fileName}|}" 
											th:data-uploadpath="${pay.uploadPath}" th:data-uuid="${pay.uuid}"
											th:data-fileName="${pay.fileName}" data-type="true"  style="border:1px solid;">
										</div>
									</li>
								   </ul>
								</div>
	                        <div class="uploadResult1">
	                            <ul>
	
	                            </ul>
	                        </div>
	                    	</div>
	                    </td></tr>
				<tr><td>
					<div class="panel-body2">
                        <div class="form-group uploadDiv2">
                            <input name="uploadFile2" type="file" multiple>
                        </div>
                        <div class="uploadResult2">
                            <ul>

                            </ul>
                        </div>
                    </div>
                </td></tr>
				</th:block>
				<th:block th:if="${list.docType=='b'}">
				<tr>
					<td style="display:none" id="offdocType" th:value="${list.docType}"></td>
				</tr>
				<tr>
					<td>시작일 <input type="date" id="useDate" th:value="${#dates.format(list.useDate,'yyyy-MM-dd')}"></td>
					<td>복귀일 <input type="date" id="returnDate" th:value="${#dates.format(list.returnDate,'yyyy-MM-dd')}"></td>
				</tr>
				<tr>
					<td>제목 <input type="text" id="offTitle" th:value="${list.title}"></td>
				</tr>
				<tr>
					<td>내용 <textarea id="offContent" style="width: 400px;height: 200px;" th:text="${list.content}"></textarea></td>
				</tr>
						<tr><td><div class="panel-body3">
	                        <div class="form-group uploadDiv3">
	                            <input name="uploadFile3" type="file" multiple>
	                        </div>
		                        <!-- foreach써서 조회하는걸로 변경 -->
								<div class="uploadResult0">
							       <ul th:each="pay : ${payImgInfo}">
									<li th:data-path="${pay.uploadPath}" th:data-uuid="${pay.uuid}"
									th:data-fileName="${pay.fileName}" data-type="true" style="list-style-type:none">
										<button type="button" id="offImgDel" onclick="payImgDel(this)">제거</button>
										<div>
											<img th:src="@{|/display?fileName=${#strings.replace(pay.uploadPath,'\','/')}/${pay.uuid}_${pay.fileName}|}" 
											th:data-uploadpath="${pay.uploadPath}" th:data-uuid="${pay.uuid}"
											th:data-fileName="${pay.fileName}" data-type="true"  style="border:1px solid;">
										</div>
									</li>
								   </ul>
								</div>
	                        <div class="uploadResult3">
	                            <ul>
	
	                            </ul>
	                        </div>
	                    	</div>
	                    </td></tr>
				<tr>
					<td>코멘트 <textarea id="offCom" style="width: 400px;height: 200px;" th:text="${list.com}"></textarea></td>
				</tr>
				</th:block>
				<th:block th:if="${list.docType == 'c'}">
				<tr>
					<td style="display:none" id="robindocType" th:value="${list.docType}"></td>
				</tr>
				<tr>
					<td>제목 <input type="text" id="robinTitle" th:value="${list.title}"></td>
				</tr>
				<tr>
					<td>내용 <textarea id="robinContent" style="width: 400px;height: 200px;" th:text="${list.content}"></textarea></td>
				</tr>
						<tr><td><div class="panel-body4">
	                        <div class="form-group uploadDiv4">
	                            <input name="uploadFile4" type="file" multiple>
	                        </div>
	                        <div class="uploadResult0">
							       <ul th:each="pay : ${payImgInfo}">
									<li th:data-path="${pay.uploadPath}" th:data-uuid="${pay.uuid}"
									th:data-fileName="${pay.fileName}" data-type="true" style="list-style-type:none">
										<button type="button" id="robinImgDel" onclick="payImgDel(this)">제거</button>
										<div>
											<img th:src="@{|/display?fileName=${#strings.replace(pay.uploadPath,'\','/')}/${pay.uuid}_${pay.fileName}|}" 
											th:data-uploadpath="${pay.uploadPath}" th:data-uuid="${pay.uuid}"
											th:data-filename="${pay.fileName}" data-type="true"  style="border:1px solid;">
										</div>
									</li>
								   </ul>
								</div>
	                        <div class="uploadResult4">
	                            <ul>
	
	                            </ul>
	                        </div>
	                    	</div>
                </td></tr>
				<tr>
					<td>코멘트 <textarea id="robinCom" style="width: 400px;height: 200px;" th:text="${list.com}"></textarea></td>
				</tr>
			</th:block>
			</tbody>
		</table>
		<th:block th:if="${(list.approver2 == session.Id and list.payStatus3 == 'N') OR
							(list.id == session.Id and list.payStatus2 == 'N') }">
			<button type="button" id="paymentModify" onclick="paymentModify()" style="margin-left:10px">수정</button>
		</th:block>
		<th:block th:if="${(list.approver2 == session.Id and list.payStatus2 == 'N') OR
							(list.approver3 == session.Id and list.payStatus3 == 'N')}">
			<button type="button" id="paymentOk" onclick="paymentOk()" style="margin-left:10px">결재</button>
		</th:block>
		<th:block th:if="${(list.approver2 == session.Id and list.payStatus2 == 'N') OR
							(list.approver3 == session.Id and list.payStatus3 == 'N')}">
			<button type="button" id="paymentPass" onclick="paymentPass()" style="margin-left:10px">반려</button>
		</th:block>
	</div>
	<script>
	/*<![CDATA[*/
		//기본값
		let masterDocType = document.getElementById('masterDocType').value;
		let payNo = document.getElementById('payNo').value;
		let userId = document.getElementById('sessionId').textContent;
		let issueDate = document.getElementById('issueDate').value;
		let drafter = document.getElementById('drafter').value;
		let approver2 = document.getElementById('approver2').value;
		let approver3 = document.getElementById('approver3').value;
		let payStatus2 = document.getElementById('payStatus2').value;
		let payStatus3 = document.getElementById('payStatus3').value;
		if(masterDocType === 'a'){
			let befored = document.getElementById('befored').value;
			let afterd = document.getElementById('afterd').value;
			let imprestText = document.getElementById('imprest');
		}
		//이미지 제거용 구이미지 값 저장용
		let olduuid = "";
		let olduploadPath = "";
		let fileName = "";
		let delOn = "";
		let upCheck = "";
		let car1uploadPath = '';
		let car1uuid = '';
		let car1fileName = '';
		let car2uploadPath = '';
		let car2uuid = '';
		let car2fileName = '';
		let offuuid = '';
		let offuploadPath = '';
		let offfileName = '';
		let robinuuid = '';
		let robinuploadPath = '';
		let robinfileName = '';
		if(masterDocType=='a'){
		//운행일지
			let purpose = document.getElementById('purpose').value;
			let operDate = document.getElementById('operDate').value;
			let destination = document.getElementById('destination').value;
			let befored = document.getElementById('befored').value;
			let afterd = document.getElementById('afterd').value;
			console.log('masterDocType',masterDocType);
			console.log('payNo',payNo);
			console.log('userId',userId);
			console.log('issueDate',issueDate);
			console.log('purpose',purpose);
			console.log('operDate',operDate);
			console.log('destination',destination);
			console.log('befored',befored);
			console.log('afterd',afterd);
		}else if(masterDocType=='b'){
		//연차계
			let useDate = document.getElementById('useDate').value;
			let returnDate = document.getElementById('returnDate').value;
			let offTitle = document.getElementById('offTitle').value;
			let offContent = document.getElementById('offContent').value;
			let offCom = document.getElementById('offCom').value;
			console.log('useDate',useDate);
			console.log('returnDate',returnDate);
			console.log('offTitle',offTitle);
			console.log('offContent',offContent);
			console.log('offCom',offCom);
		}else{
		//품의서
			let robinTitle = document.getElementById('robinTitle').value;
			let robinContent = document.getElementById('robinContent').value;
			let robinCom = document.getElementById('robinCom').value;
			console.log('robinTitle',robinTitle);
			console.log('robinContent',robinContent);
			console.log('robinCom',robinCom);
		}
		function paymentModify(){
			//각 버튼들은 공용이기때문에 if조건으로 문서값에 맞추어 값을 유지
			if(masterDocType==='a'){
				//값 초기화
				let purpose = document.getElementById('purpose').value;
				let operDate = document.getElementById('operDate').value;
				let destination = document.getElementById('destination').value;
				let befored = document.getElementById('befored').value;
				let afterd = document.getElementById('afterd').value;
				let imprest = ((afterd*1)-(befored*1))*1500;
				console.log('masterDocType',masterDocType);
				console.log('payNo',payNo);
				console.log('userId',userId);
				console.log('issueDate',issueDate);
				console.log('purpose',purpose);
				console.log('operDate',operDate);
				console.log('destination',destination);
				console.log('befored',befored);
				console.log('afterd',afterd);
				console.log(imprest);
				console.log(approver2);
				console.log(approver3);
				//파일지우기
				if(delOn==='o'){
					console.log(payNo);
					$.ajax({
						url:"/payfiledel",
						method: "POST",
		  			    contentType:"application/json; charset=utf-8",
		  			    data: JSON.stringify({
		  			    	payNo : payNo
		  			    }),
		  			    async : false,
		  			  	success: function(data) {
		  			    	console.log(data);
		  			    	console.log('delOn = ',delOn);
		  			    	console.log('afterd = ',afterd);
		  			    },
		  			    error: function(err) {
							console.log(err);
		  			    }
					});
				}
				delOn="";
				//controller에 전송하는 운행일지 첨부파일 1번
				if(car1uuid!==""){
					$.ajax({
		    			url: "/logInsert",
		  			    method: "POST",
		  			    contentType:"application/json; charset=utf-8",
		  			    data: JSON.stringify({
		  			      payNo : payNo,
		  			      uuid : car1uuid,
		  			      uploadPath : car1uploadPath,
		  			      fileName : car1fileName
		  			    }),
		  			    success: function(data) {
		  			    	console.log(data);
		  			    },
		  			    error: function(err) {
							console.log(err);
		  			    }	
		    		});
				}
				if(car2uuid!==""){
					//controller에 전송하는 운행일지 첨부파일 2번
					$.ajax({
		    			url: "/logInsert",
		  			    method: "POST",
		  			    contentType:"application/json; charset=utf-8",
		  			    data: JSON.stringify({
		  			      payNo : payNo,
		  			      uuid : car2uuid,
		  			      uploadPath : car2uploadPath,
		  			      fileName : car2fileName
		  			    }),
		  			    success: function(data) {
		  			    	console.log(data);
		  			    },
		  			    error: function(err) {
							console.log(err);
		  			    }	
		    		});
				}
				//ajax로 값보내줌
				$.ajax({
					url:"/paymentUpdate",
					method: "POST",
	  			    contentType:"application/json; charset=utf-8",
	  			    data: JSON.stringify({
	  			    	payNo : payNo,
						operDate : operDate,
						docType : masterDocType,
						id : userId,
						imprest : imprest,
						purpose : purpose,
						approver2 : approver2,
						approver3 : approver3,
						destination : destination,
						befored : befored,
						afterd : afterd,
	  			    }),
	  			    async : false,
	  			  	success: function(data) {
	  			    	console.log(data);
	  			    	location.href="/pay/InProgressPay";
	  			    },
	  			    error: function(err) {
						console.log(err);
	  			    }
				});
				//파일업로드
			}else if(masterDocType=='b'){
				let useDate = document.getElementById('useDate').value;
				let returnDate = document.getElementById('returnDate').value;
				let offTitle = document.getElementById('offTitle').value;
				let offContent = document.getElementById('offContent').value;
				let offCom = document.getElementById('offCom').value;
				console.log('useDate',useDate);
				console.log('returnDate',returnDate);
				console.log('offTitle',offTitle);
				console.log('offContent',offContent);
				console.log('offCom',offCom);
				if(delOn === 'o'){
					console.log('delOn = o');
					$.ajax({
						url:"/payfiledel",
						method: "POST",
		  			    contentType:"application/json; charset=utf-8",
		  			    data: JSON.stringify({
		  			    	payNo : payNo
		  			    }),
		  			    async : false,
		  			  	success: function(data) {
		  			    	console.log(data);
		  			    },
		  			    error: function(err) {
							console.log(err);
		  			    }
					});
				}
				delOn="";
				console.log('offuuid',offuuid);
				console.log('offuploadPath',offuploadPath);
				console.log('offfileName',offfileName);
				if(offuuid!==""){
					$.ajax({
		    			url: "/logInsert",
		  			    method: "POST",
		  			    contentType:"application/json; charset=utf-8",
		  			    data: JSON.stringify({
		  			    	payNo : payNo,
		  			    	uuid : offuuid,
		  			    	uploadPath : offuploadPath,
		  			    	fileName : offfileName
		  			    }),
		  			    success: function(data) {
		  			    	console.log(data);
		  			    },
		  			    error: function(err) {
							console.log(err);
		  			    }	
		    		});
				}
				//ajax
				$.ajax({
					url:"/paymentUpdate",
					method: "POST",
	  			    contentType:"application/json; charset=utf-8",
	  			    data: JSON.stringify({
	  			    	payNo : payNo,
						docType : masterDocType,
						id : userId,
						approver2 : approver2,
						approver3 : approver3,
						useDate : useDate,
						returnDate : returnDate,
						title : offTitle,
						content : offContent,
						com : offCom
	  			    }),
	  			    async : false,
	  			  	success: function(data) {
	  			    	console.log(data);
	  			    	location.href="/pay/InProgressPay";
	  			    },
	  			    error: function(err) {
						console.log(err);
	  			    }
				});
  				//controller에 전송하는 연차계 첨부파일 1번
			}else{
				let robinTitle = document.getElementById('robinTitle').value;
				let robinContent = document.getElementById('robinContent').value;
				let robinCom = document.getElementById('robinCom').value;
				console.log('robinTitle',robinTitle);
				console.log('robinContent',robinContent);
				console.log('robinCom',robinCom);
				if(delOn === 'o'){
					console.log('delOn = o');
					$.ajax({
						url:"/payfiledel",
						method: "POST",
		  			    contentType:"application/json; charset=utf-8",
		  			    data: JSON.stringify({
		  			    	payNo : payNo
		  			    }),
		  			    async : false,
		  			  	success: function(data) {
		  			    	console.log(data);
		  			    },
		  			    error: function(err) {
							console.log(err);
		  			    }
					});
				}
				//controller에 전송하는 연차 첨부파일 1번
				if(robinuuid!==""){
					$.ajax({
		    			url: "/logInsert",
		  			    method: "POST",
		  			    contentType:"application/json; charset=utf-8",
		  			    data: JSON.stringify({
		  			      payNo : payNo,
		  			      uuid : robinuuid,
		  			      uploadPath : robinuploadPath,
		  			      fileName : robinfileName
		  			    }),
		  			    success: function(data) {
		  			    	console.log(data);
		  			    },
		  			    error: function(err) {
							console.log(err);
		  			    }	
		    		});
				}
				//ajax
				$.ajax({
					url:"/paymentUpdate",
					method: "POST",
	  			    contentType:"application/json; charset=utf-8",
	  			    data: JSON.stringify({
	  			    	payNo : payNo,
						docType : masterDocType,
						id : userId,
						approver2 : approver2,
						approver3 : approver3,
						title : robinTitle,
						content : robinContent,
						com : robinCom
	  			    }),
	  			    async : false,
	  			  	success: function(data) {
	  			    	console.log(data);
	  			    	location.href="/pay/InProgressPay";
	  			    },
	  			    error: function(err) {
						console.log(err);
	  			    }
				});
			}
			
		}
		function paymentOk(){
			console.log('결재통과');
			if(approver2 === userId){
				console.log('이전payStatus2',payStatus2);
				payStatus2 = 'Y';
				console.log('바뀐payStatus2',payStatus2);
			}else if(approver3 === userId){
				console.log('이전payStatus3',payStatus2);
				payStatus3 = 'Y';
				console.log('바뀐payStatus3',payStatus2);
			}
			$.ajax({
				url:"/paymentReject",
				method: "POST",
  			    contentType:"application/json; charset=utf-8",
  			    data: JSON.stringify({
  			    	payNo : payNo,
					docType : masterDocType,
					id : drafter,
					approver2 : approver2,
					approver3 : approver3,
					payStatus2 : payStatus2,
					payStatus3 : payStatus3
  			    }),
  			    async : false,
  			  	success: function(data) {
  			    	console.log(data);
  			    	location.href="/pay/InProgressPay";
  			    },
  			    error: function(err) {
					console.log(err);
  			    }
			});
		}
		function paymentPass(){
			console.log('결재반려');	
			console.log('결재통과');
			if(approver2 === userId){
				console.log('이전payStatus2',payStatus2);
				payStatus2 = 'F';
				console.log('바뀐payStatus2',payStatus2);
			}else if(approver3 === userId){
				console.log('이전payStatus3',payStatus2);
				payStatus3 = 'F';
				console.log('바뀐payStatus3',payStatus2);
			}
			$.ajax({
				url:"/paymentReject",
				method: "POST",
  			    contentType:"application/json; charset=utf-8",
  			    data: JSON.stringify({
  			    	payNo : payNo,
					docType : masterDocType,
					id : drafter,
					approver2 : approver2,
					approver3 : approver3,
					payStatus2 : payStatus2,
					payStatus3 : payStatus3
  			    }),
  			    async : false,
  			  	success: function(data) {
  			    	console.log(data);
  			    	location.href="/pay/InProgressPay";
  			    },
  			    error: function(err) {
					console.log(err);
  			    }
			});
		}
		function payImgDel(elem){
			olduuid = "";
			olduploadPath = "";
			oldfileName = "";
			console.log(elem.parentElement);
			elem.parentElement.remove();
			delOn = "o";
			console.log(delOn);
		}
		function showUploadResult1(uploadResultArr){
            console.log(uploadResultArr)
		  if(!uploadResultArr || uploadResultArr.length == 0){return ;}
		  var uploadUL1 = $(".uploadResult1 ul");
		  var str = "";
		  
		  $(uploadResultArr).each(function(i, obj){
            console.log("11:06" + i)
			  console.log("11:05" + obj)
              console.log(obj.image)
              console.log(obj.fileType)
			   //image type
		        if(obj.image){
		          var fileCallPath =  encodeURIComponent( obj.uploadPath+ "/s_"+obj.uuid +"_"+obj.fileName);
		          str += "<li data-path='"+obj.uploadPath+"'";
                  str += "data-uuid='"+obj.uuid+"' data-filename='"+obj.fileName+"'data-type='"+obj.image+"'"
                  str + "><div>";
		          str += "<span> "+ obj.fileName+"</span>";
		          str += "<button type='button' onclick='imgTagDel(this)' data-file=\'"+fileCallPath+"\' data-type='image' class='btn btn-warning btn-circle'><i class='fa fa-times'></i></button><br>";
		          str += "<img src='/display?fileName="+fileCallPath+"'>";
		          str += "</div>";
		          str +"</li>";
		        }else{
		          var fileCallPath =  encodeURIComponent( obj.uploadPath+"/"+ obj.uuid +"_"+obj.fileName);            
		          var fileLink = fileCallPath.replace(new RegExp(/\\/g),"/");
		              
                  str += "<li data-path='"+obj.uploadPath+"'";
                  str += "data-uuid='"+obj.uuid+"' data-filename='"+obj.fileName+"'data-type='"+obj.image+"'"
                  str + "><div>";
		          str += "<span> "+ obj.fileName+"</span>";
		          str += "<button type='button' data-file=\'"+fileCallPath+"\' data-type='file' class='btn btn-warning btn-circle'><i class='fa fa-times'></i></button><br>";
		          str += "<img src='img/attach.png/' style='height:100px; width:100px;'></a>";
		          str += "</div>";
		          str +"</li>";
		        } 
		  });
		  uploadUL1.append(str);
	    }
		function showUploadResult2(uploadResultArr){
            console.log(uploadResultArr)
		  if(!uploadResultArr || uploadResultArr.length == 0){return ;}
		  var uploadUL2 = $(".uploadResult2 ul");
		  var str = "";
		  
		  $(uploadResultArr).each(function(i, obj){
            console.log("11:06" + i)
			  console.log("11:05" + obj)
              console.log(obj.image)
              console.log(obj.fileType)
			   //image type
		        if(obj.image){
		          var fileCallPath =  encodeURIComponent( obj.uploadPath+ "/s_"+obj.uuid +"_"+obj.fileName);
		          str += "<li data-path='"+obj.uploadPath+"'";
                  str += "data-uuid='"+obj.uuid+"' data-filename='"+obj.fileName+"'data-type='"+obj.image+"'"
                  str + "><div>";
		          str += "<span> "+ obj.fileName+"</span>";
		          str += "<button type='button' data-file=\'"+fileCallPath+"\' data-type='image' class='btn btn-warning btn-circle'><i class='fa fa-times'></i></button><br>";
		          str += "<img src='/display?fileName="+fileCallPath+"'>";
		          str += "</div>";
		          str +"</li>";
		        }else{
		          var fileCallPath =  encodeURIComponent( obj.uploadPath+"/"+ obj.uuid +"_"+obj.fileName);            
		          var fileLink = fileCallPath.replace(new RegExp(/\\/g),"/");
		              
                  str += "<li data-path='"+obj.uploadPath+"'";
                  str += "data-uuid='"+obj.uuid+"' data-filename='"+obj.fileName+"'data-type='"+obj.image+"'"
                  str + "><div>";
		          str += "<span> "+ obj.fileName+"</span>";
		          str += "<button type='button' data-file=\'"+fileCallPath+"\' data-type='file' class='btn btn-warning btn-circle'><i class='fa fa-times'></i></button><br>";
		          str += "<img src='img/attach.png/' style='height:100px; width:100px;'></a>";
		          str += "</div>";
		          str +"</li>";
		        } 
		  });
		  uploadUL2.append(str);
	    }
		
		function showUploadResult3(uploadResultArr){
            console.log(uploadResultArr)
		  if(!uploadResultArr || uploadResultArr.length == 0){return ;}
		  var uploadUL3 = $(".uploadResult3 ul");
		  var str = "";
		  
		  $(uploadResultArr).each(function(i, obj){
            console.log("11:06" + i)
			  console.log("11:05" + obj)
              console.log(obj.image)
              console.log(obj.fileType)
			   //image type
		        if(obj.image){
		          var fileCallPath =  encodeURIComponent( obj.uploadPath+ "/s_"+obj.uuid +"_"+obj.fileName);
		          str += "<li data-path='"+obj.uploadPath+"'";
                  str += "data-uuid='"+obj.uuid+"' data-filename='"+obj.fileName+"'data-type='"+obj.image+"'"
                  str + "><div>";
		          str += "<span> "+ obj.fileName+"</span>";
		          str += "<button type='button' data-file=\'"+fileCallPath+"\' data-type='image' class='btn btn-warning btn-circle'><i class='fa fa-times'></i></button><br>";
		          str += "<img src='/display?fileName="+fileCallPath+"'>";
		          str += "</div>";
		          str +"</li>";
		        }else{
		          var fileCallPath =  encodeURIComponent( obj.uploadPath+"/"+ obj.uuid +"_"+obj.fileName);            
		          var fileLink = fileCallPath.replace(new RegExp(/\\/g),"/");
		              
                  str += "<li data-path='"+obj.uploadPath+"'";
                  str += "data-uuid='"+obj.uuid+"' data-filename='"+obj.fileName+"'data-type='"+obj.image+"'"
                  str + "><div>";
		          str += "<span> "+ obj.fileName+"</span>";
		          str += "<button type='button' data-file=\'"+fileCallPath+"\' data-type='file' class='btn btn-warning btn-circle'><i class='fa fa-times'></i></button><br>";
		          str += "<img src='img/attach.png/' style='height:100px; width:100px;'></a>";
		          str += "</div>";
		          str +"</li>";
		        } 
		  });
		  uploadUL3.append(str);
	    }
		
		function showUploadResult4(uploadResultArr){
            console.log(uploadResultArr)
		  if(!uploadResultArr || uploadResultArr.length == 0){return ;}
		  var uploadUL4 = $(".uploadResult4 ul");
		  var str = "";
		  
		  $(uploadResultArr).each(function(i, obj){
            console.log("11:06" + i)
			  console.log("11:05" + obj)
              console.log(obj.image)
              console.log(obj.fileType)
			   //image type
		        if(obj.image){
		          var fileCallPath =  encodeURIComponent( obj.uploadPath+ "/s_"+obj.uuid +"_"+obj.fileName);
		          str += "<li data-path='"+obj.uploadPath+"'";
                  str += "data-uuid='"+obj.uuid+"' data-filename='"+obj.fileName+"'data-type='"+obj.image+"'"
                  str + "><div>";
		          str += "<span> "+ obj.fileName+"</span>";
		          str += "<button type='button' data-file=\'"+fileCallPath+"\' data-type='image' class='btn btn-warning btn-circle'><i class='fa fa-times'></i></button><br>";
		          str += "<img src='/display?fileName="+fileCallPath+"'>";
		          str += "</div>";
		          str +"</li>";
		        }else{
		          var fileCallPath =  encodeURIComponent( obj.uploadPath+"/"+ obj.uuid +"_"+obj.fileName);            
		          var fileLink = fileCallPath.replace(new RegExp(/\\/g),"/");
		              
                  str += "<li data-path='"+obj.uploadPath+"'";
                  str += "data-uuid='"+obj.uuid+"' data-filename='"+obj.fileName+"'data-type='"+obj.image+"'"
                  str + "><div>";
		          str += "<span> "+ obj.fileName+"</span>";
		          str += "<button type='button' data-file=\'"+fileCallPath+"\' data-type='file' class='btn btn-warning btn-circle'><i class='fa fa-times'></i></button><br>";
		          str += "<img src='img/attach.png/' style='height:100px; width:100px;'></a>";
		          str += "</div>";
		          str +"</li>";
		        } 
		  });
		  uploadUL4.append(str);
	    }
		//운행전 첨부파일
	    $("input[name='uploadFile1']").change(function(e) {
	        var formData = new FormData();
	        var inputFile1 = $("input[name='uploadFile1']");
	        var files = inputFile1[0].files;
	
	        for(var i=0; i<files.length; i++) {
	
	            if(!checkExtension(files[i].name, files[i].size) ){
	                return false;
	            }
	            formData.append("uploadFile", files[i]);
	
	        }
	        $.ajax({
				url: "/uploadAjaxAction",
				processData: false,
				contentType: false,
				data: formData,
				type: "POST",
				dataType: "json",
				success: function(result) {
	                console.log('result = ',result);
	                showUploadResult1(result);
	                car1uuid = result[0].uuid;
	                car1fileName = result[0].fileName;
	                car1uploadPath = result[0].uploadPath;
	                upCheck = "o";
				},
				error: function(error) {
					console.log(error);
				}
			});
	    });
	    //운행후 첨부파일
	    $("input[name='uploadFile2']").change(function(e) {
	        var formData = new FormData();
	        var inputFile2 = $("input[name='uploadFile2']");
	        var files = inputFile2[0].files;
	
	        for(var i=0; i<files.length; i++) {
	
	            if(!checkExtension(files[i].name, files[i].size) ){
	                return false;
	            }
	            formData.append("uploadFile", files[i]);
	
	        }
	        $.ajax({
				url: "/uploadAjaxAction",
				processData: false,
				contentType: false,
				data: formData,
				type: "POST",
				dataType: "json",
				success: function(result) {
	                console.log('result = ',result);
	                showUploadResult2(result);
	                car2uuid = result[0].uuid;
	                car2fileName = result[0].fileName;
	                car2uploadPath = result[0].uploadPath;
	                upCheck = "o";
				},
				error: function(error) {
					console.log(error);
				}
			});
	    });
	    //연차계 첨부파일
	    $("input[name='uploadFile3']").change(function(e) {
	        var formData = new FormData();
	        var inputFile3 = $("input[name='uploadFile3']");
	        var files = inputFile3[0].files;
	
	        for(var i=0; i<files.length; i++) {
	
	            if(!checkExtension(files[i].name, files[i].size) ){
	                return false;
	            }
	            formData.append("uploadFile", files[i]);
	
	        }
	        $.ajax({
				url: "/uploadAjaxAction",
				processData: false,
				contentType: false,
				data: formData,
				type: "POST",
				dataType: "json",
				success: function(result) {
	                console.log('result = ',result);
	                showUploadResult3(result);
	                offuuid = result[0].uuid;
	        		offuploadPath = result[0].uploadPath;
	        		offfileName = result[0].fileName;
	        		console.log('offu',offuuid);
	        		console.log('offup',offuploadPath);
	        		console.log('offf',offfileName);
	        		upCheck = "o";
				},
				error: function(error) {
					console.log(error);
				}
			});
	    });
	    //품의서 첨부파일
	    $("input[name='uploadFile4']").change(function(e) {
	        var formData = new FormData();
	        var inputFile4 = $("input[name='uploadFile4']");
	        var files = inputFile4[0].files;
	
	        for(var i=0; i<files.length; i++) {
	
	            if(!checkExtension(files[i].name, files[i].size) ){
	                return false;
	            }
	            formData.append("uploadFile", files[i]);
	
	        }
	        $.ajax({
				url: "/uploadAjaxAction",
				processData: false,
				contentType: false,
				data: formData,
				type: "POST",
				dataType: "json",
				success: function(result) {
	                console.log('result = ',result);
	                showUploadResult4(result);
	                robinuuid = result[0].uuid;
	                robinfileName = result[0].fileName;
	                robinuploadPath = result[0].uploadPath;
	                upCheck = "o";
				},
				error: function(error) {
					console.log(error);
				}
			});
	    });
	    var regex = new RegExp("(.*?)\\.(sh|alz)$"); //제외하고 싶은 확장자.
	    var maxSize = 5242880;
	
	    function checkExtension(fileName, fileSize) {
	        if (fileSize >= maxSize) {
	            alert('파일 사이즈 초과');
	            return false;
	        }
	        if (regex.test(fileName)) {
	            alert('해당 종류의 파일은 업로드할 수 없습니다.');
	            return false;
	        }
	        return true;
	    }
	    function kmChange(){
	    	befored = document.getElementById('befored').value;
			afterd = document.getElementById('afterd').value;
			imprest = ((afterd*1)-(befored*1))*1500;
			imprestText.value = imprest;
	    }
	    function imgTagDel(elem){
	    	elem.parentElement.remove();
	    	upCheck = "x";
	    }
	/*]]>*/
	</script>
</body>
</html>