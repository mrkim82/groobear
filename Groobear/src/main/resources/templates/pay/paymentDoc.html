<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
 layout:decorate="~{layout/paymentTiles}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body layout:fragment="content">
	<div>
		<form style="width:1200px; height:2000px">
			<table style="float:right">
				<thead>
					<tr style="display:inline-block">
						<td style="width:130px">기안자</td>
						<td style="width:130px">결재자1</td>
						<td style="width:100px">결재자2</td>
					</tr>
				</thead>
				<tbody>
					<tr style="display:inline-block">
						<td style="width:130px; height:100px; background-color:aquamarine">기안자사인1</td>
					</tr>
					<tr style="display:inline-block">
						<td style="width:130px; height:100px; background-color:MediumOrchid">결재자사인1</td>
					</tr>
					<tr style="display:inline-block">
						<td style="width:130px; height:100px; background-color:DeepSkyBlue">결재자사인2</td>
					</tr>
					<tr id="drafter">
						<td></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
					</tr>
					<tr id="payUserList1">
						<td></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
					</tr>
					<tr id="payUserList2">
						<td></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
					</tr>
				</tbody>
			</table>
			<table style="float:left">
				<tbody>
					<tr>
						<td>문서번호 : [[${paymentNo}]]</td>
					</tr>
					<tr>
						<td id="drafter">기안자 : [[${userInfo.name}]] [[${userInfo.rank}]] [[${userInfo.deptName}]]</td>
					</tr>
					<tr>
						<td><button id="childClick" type="button" onclick="payUserSelect();">결재자선택</button></td>
					</tr>
					<tr>
						<td><button id="referrerClick" type="button" onclick="referrerSelect();">참조자선택</button></td>
					</tr>
					<tr id="referrerList" >
						<td style="width:150px" ></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="width:150px"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="width:150px"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
						<td style="display:none"></td>
					</tr>
					<tr>
						<td>작성일자 <input type="date" id="now_date" readonly></td>
					</tr>
					<tr>
						<td><select id="payType" onchange="paychange()">
							<option value="" selected>결재문서종류</option>
							<option value="a">운행일지</option>
							<option value="b">연차계</option>
							<option value="c">품의서</option>
						</select></td>
					</tr>
					<tbody id="payNum1" style="display:none">
						<tr><td><input type="date" id="carDate" value="sysdate"></td></tr>
						<tr><td>행선지 : <input type="text" id="carAddr" value="addr"></td></tr>
						<tr><td>운행전키로수 <input type="text" id="km1" value="1km"></td>
							<td>운행후키로수 <input type="text" id="km2" value="2km"></td>
						</tr>
						<tr><td>운행전 <button type="button" id="carfiles1">파일첨부</button></td></tr>
						<tr><td>운행후 <button type="button" id="carfiles2">파일첨부</button></td></tr>
						<tr><td><button type="button" onclick="payNumSend1()">결재</button></td></tr>
					</tbody>
					<tbody id="payNum2" style="display:none">
						<tr><td><input type="date" id="off1">(연차시작일)</td></tr>
						<tr><td><input type="date" id="off2">(복귀일)</td></tr>
						<tr><td><input type="text" id="offtitle" style="width:500px"></td></tr>
						<tr><td><textarea id="offcontent" style="width:400px; height:200px"></textarea></td></tr>
						<tr><td><button type="button" id="offfiles">첨부파일(선택)</button></td></tr>
						<tr><td><textarea id="offcomment" style="width:400px; height:100px"></textarea></td></tr>
						<tr><td><button type="button" onclick="payNumSend2()">결재</button></td></tr>
					</tbody>
					<tbody id="payNum3" style="display:none">
						<tr><td><input type="text" id="robintitle" style="width:500px"></td></tr>
						<tr><td><textarea id="robincontent" style="width:400px; height:200px"></textarea></td></tr>
						<tr><td><button type="button" id="robinofffiles">첨부파일(선택)</button></td></tr>
						<tr><td><textarea id="robincomment" style="width:400px; height:100px">코멘트(선택)</textarea></td></tr>
						<tr><td><button type="button" onclick="payNumSend3()">결재</button></td></tr>
					</tbody>
				</tbody>
			</table>
		</form>
	</div>
	<script th:inline="javascript">
	/*<![CDATA[*/
		let openPayuser;
		let openReferreruser;
		let payUserList1 = document.getElementById('payUserList1').children[1].textContent;
		let payUserList2 = document.getElementById('payUserList2').children[1].textContent;
		let referrerList = document.getElementById('referrerList');
		let referrer1 = '';
		let referrer2 = '';
		let referrer3 = '';
		let referrer = '';
		let drafter = /*[[${userInfo.id}]]*/
		let payNo = /*[[${paymentNo}]]*/
		console.log('payNo',payNo);
		console.log('drafter = ',drafter);
		//select 번호
		var selectPay = document.getElementById('payType');
		var payNum1 = document.getElementById('payNum1');
		var payNum2 = document.getElementById('payNum2');
		var payNum3 = document.getElementById('payNum3');
		//문서 데이터 변수
		document.getElementById('now_date').valueAsDate = new Date();
		let nowDate = document.getElementById('now_date').value;
		
		let off1 = document.getElementById('off1').value;
		let off2 = document.getElementById('off2').value;
		let offtitle = document.getElementById('offtitle').value;
		let offcontent = document.getElementById('offcontent').value;
		let offcomment = document.getElementById('offcomment').value;
		let carDate = document.getElementById('carDate').value;
		let carAddr = document.getElementById('carAddr').value;
		let km1 = document.getElementById('km1').value;
		let km2 = document.getElementById('km2').value;
		let robintitle = document.getElementById('robintitle').value;
		let robincontent = document.getElementById('robincontent').value;
		let robincomment = document.getElementById('robincomment').value;
		//if조건에 결재자1,결재자2,참조자 데이터 있으면 받아오기
		if(payUserList1 !== ''){
			console.log('payUserList1 공백아님');
		}
		function paychange(){
			console.log(selectPay.value);
			if(selectPay.value == 'a'){
				console.log('a맞음');
				$(payNum2).hide() //.style.display = 'none';
				$(payNum3).hide() //.style.display = 'none';
				payNum1.style.display = 'block';
				off1 = '';
				off2 = '';
				offtitle = '';
				offcontent = '';
				offcomment = '';
				robintitle = '';
				robincontent = '';
				robincomment = '';
			}else if(selectPay.value == 'b'){
				payNum1.style.display = 'none';
				payNum3.style.display = 'none';
				payNum2.style.display = 'block';
				carDate = '';
				carAddr = '';
				km1 = '';
				km2 = '';
				robintitle = '';
				robincontent = '';
				robincomment = '';
			}else if(selectPay.value == 'c'){
				payNum1.style.display = 'none';
				payNum2.style.display = 'none';
				payNum3.style.display = 'block';
				off1 = '';
				off2 = '';
				offtitle = '';
				offcontent = '';
				offcomment = '';
				carDate = '';
				carAddr = '';
				km1 = '';
				km2 = '';
			}
		}
		function referrerSelect(){
			//참조자 등록하는 자식창 열기
			openReferreruser = window.open("/pay/referrerEmp","referrerEmp","width=700, height=500, resizable = no");
		}
		function payUserSelect(){
			//결재자 등록하는 자식창 열기
			openPayuser = window.open("/pay/paymentEmp","paymentEmp","width=700, height=500, resizable = no");
			console.log('실행됨?');
		}
		//자식창 닫았을때 데이터 저장
		//운행일지
		function payNumSend1(){
			carDate = document.getElementById('carDate').value;
			carAddr = document.getElementById('carAddr').value;
			km1 = document.getElementById('km1').value;
			km2 = document.getElementById('km2').value;
			console.log(carDate);
			console.log(carAddr);
			console.log(km1);
			console.log(km2);
			payUserList1 = document.getElementById('payUserList1').children[1].textContent;
			payUserList2 = document.getElementById('payUserList2').children[1].textContent;
			if(payUserList1 === ''){
				alert('결재자1이 없습니다 반드시 등록하세요');
				return;
			}
			if(referrerList.children[11].textContent !== ''){
				console.log('11번째는 있음');
				referrer1 = referrerList.children[1].textContent;
				referrer2 = referrerList.children[6].textContent;
				referrer3 = referrerList.children[11].textContent;
				referrer = referrer1,','+referrer2,',',referrer3;
				console.log('referrer = ',referrer);
			}else if(referrerList.children[6].textContent !== ''){
				referrer1 = referrerList.children[1].textContent;
				referrer2 = referrerList.children[6].textContent;
				referrer = referrer1,',',referrer2;
				console.log(referrer);
			}else if(referrerList.children[1].textContent !== ''){
				referrer = referrerList.children[1].textContent;
				console.log(referrer);
			}else{
				console.log('참조자 없음 값없음');
			}
			console.log('payNo',payNo);
			console.log('carDate',carDate);
			console.log('selectPay',selectPay.value);
			console.log('id',drafter);
			console.log('approver2',payUserList1);
			console.log('approver3',payUserList2);
			console.log('s')
			fetch("/paymentDoc",{
				method: 'POST',
				headers: {
    			    'Content-Type': 'application/json'
    			  },
				body: JSON.stringify({
					//데이터
					'payNo' : payNo,
					'issueDate' : carDate,
					'docType' : selectPay.value,
					'id' : drafter,
					'approver2' : payUserList1,
					'approver3' : payUserList2,
				})
			})
			.then(response => response.text())
			.then(res =>{
				console.log('ok');
				location.href="/mail/sendingMail";
			})
			.catch(err => console.log(err));
		}
		//데이터 체크용
		/* function payNum1Check(){
			carDate = document.getElementById('carDate').value;
			carAddr = document.getElementById('carAddr').value;
			km1 = document.getElementById('km1').value;
			km2 = document.getElementById('km2').value;
			console.log(carDate);
			console.log(carAddr);
			console.log(km1);
			console.log(km2);
			payUserList1 = document.getElementById('payUserList1').children[1].textContent;
			payUserList2 = document.getElementById('payUserList2').children[1].textContent;
			if(payUserList1 === ''){
				alert('결재자1이 없습니다 반드시 등록하세요');
				return;
			}
			if(referrerList.children[11].textContent !== ''){
				console.log('11번째는 있음');
				referrer1 = referrerList.children[1].textContent;
				referrer2 = referrerList.children[6].textContent;
				referrer3 = referrerList.children[11].textContent;
				console.log(referrer1);
				console.log(referrer2);
				console.log(referrer3);
			}else if(referrerList.children[6].textContent !== ''){
				referrer1 = referrerList.children[1].textContent;
				referrer2 = referrerList.children[6].textContent;
				console.log(referrer1);
				console.log(referrer2);
			}else if(referrerList.children[1].textContent !== ''){
				referrer1 = referrerList.children[1].textContent;
				console.log(referrer1);
			}else{
				console.log('참조자 없음 값없음');
			}
			console.log(payUserList1);
			console.log(payUserList2);
		} */
		//연차계
		function payNum2Send(){
			off1 = document.getElementById('off1').value;
			off2 = document.getElementById('off2').value;
			offtitle = document.getElementById('offtitle').value;
			offcontent = document.getElementById('offcontent').value;
			offcomment = document.getElementById('offcomment').value;
			payUserList1 = document.getElementById('payUserList1').children[1].textContent;
			payUserList2 = document.getElementById('payUserList2').children[1].textContent;
			if(payUserList1 === ''){
				alert('결재자1이 없습니다 반드시 등록하세요');
				return;
			}
			if(referrerList.children[11].textContent !== ''){
				console.log('11번째는 있음');
				referrer1 = referrerList.children[1].textContent;
				referrer2 = referrerList.children[6].textContent;
				referrer3 = referrerList.children[11].textContent;
				console.log(referrer1);
				console.log(referrer2);
				console.log(referrer3);
			}else if(referrerList.children[6].textContent !== ''){
				referrer1 = referrerList.children[1].textContent;
				referrer2 = referrerList.children[6].textContent;
				console.log(referrer1);
				console.log(referrer2);
			}else if(referrerList.children[1].textContent !== ''){
				referrer1 = referrerList.children[1].textContent;
				console.log(referrer1);
			}else{
				console.log('참조자 없음 값없음');
			}
			console.log(payUserList1);
			console.log(payUserList2);
		}
		//데이터체크용
		/* function payNum2Check(){
			off1 = document.getElementById('off1').value;
			off2 = document.getElementById('off2').value;
			offtitle = document.getElementById('offtitle').value;
			offcontent = document.getElementById('offcontent').value;
			offcomment = document.getElementById('offcomment').value;
			payUserList1 = document.getElementById('payUserList1').children[1].textContent;
			payUserList2 = document.getElementById('payUserList2').children[1].textContent;
			if(payUserList1 === ''){
				alert('결재자1이 없습니다 반드시 등록하세요');
				return;
			}
			if(referrerList.children[11].textContent !== ''){
				console.log('11번째는 있음');
				referrer1 = referrerList.children[1].textContent;
				referrer2 = referrerList.children[6].textContent;
				referrer3 = referrerList.children[11].textContent;
				console.log(referrer1);
				console.log(referrer2);
				console.log(referrer3);
			}else if(referrerList.children[6].textContent !== ''){
				referrer1 = referrerList.children[1].textContent;
				referrer2 = referrerList.children[6].textContent;
				console.log(referrer1);
				console.log(referrer2);
			}else if(referrerList.children[1].textContent !== ''){
				referrer1 = referrerList.children[1].textContent;
				console.log(referrer1);
			}else{
				console.log('참조자 없음 값없음');
			}
			console.log(payUserList1);
			console.log(payUserList2);
		} */
		//품의서
		function payNum3Send(){
			let robintitle = document.getElementById('robintitle').value;
			let robincontent = document.getElementById('robincontent').value;
			let robincomment = document.getElementById('robincomment').value;
			payUserList1 = document.getElementById('payUserList1').children[1].textContent;
			payUserList2 = document.getElementById('payUserList2').children[1].textContent;
			if(payUserList1 === ''){
				alert('결재자1이 없습니다 반드시 등록하세요');
				return;
			}
			if(referrerList.children[11].textContent !== ''){
				console.log('11번째는 있음');
				referrer1 = referrerList.children[1].textContent;
				referrer2 = referrerList.children[6].textContent;
				referrer3 = referrerList.children[11].textContent;
				console.log(referrer1);
				console.log(referrer2);
				console.log(referrer3);
			}else if(referrerList.children[6].textContent !== ''){
				referrer1 = referrerList.children[1].textContent;
				referrer2 = referrerList.children[6].textContent;
				console.log(referrer1);
				console.log(referrer2);
			}else if(referrerList.children[1].textContent !== ''){
				referrer1 = referrerList.children[1].textContent;
				console.log(referrer1);
			}else{
				console.log('참조자 없음 값없음');
			}
			console.log(payUserList1);
			console.log(payUserList2);
		}
		//데이터체크용
		/* function payNum3Check(){
			let robintitle = document.getElementById('robintitle').value;
			let robincontent = document.getElementById('robincontent').value;
			let robincomment = document.getElementById('robincomment').value;
			payUserList1 = document.getElementById('payUserList1').children[1].textContent;
			payUserList2 = document.getElementById('payUserList2').children[1].textContent;
			if(payUserList1 === ''){
				alert('결재자1이 없습니다 반드시 등록하세요');
				return;
			}
			if(referrerList.children[11].textContent !== ''){
				console.log('11번째는 있음');
				referrer1 = referrerList.children[1].textContent;
				referrer2 = referrerList.children[6].textContent;
				referrer3 = referrerList.children[11].textContent;
				console.log(referrer1);
				console.log(referrer2);
				console.log(referrer3);
			}else if(referrerList.children[6].textContent !== ''){
				referrer1 = referrerList.children[1].textContent;
				referrer2 = referrerList.children[6].textContent;
				console.log(referrer1);
				console.log(referrer2);
			}else if(referrerList.children[1].textContent !== ''){
				referrer1 = referrerList.children[1].textContent;
				console.log(referrer1);
			}else{
				console.log('참조자 없음 값없음');
			}
			console.log(payUserList1);
			console.log(payUserList2);
		} */
		/*]]>*/
	</script>
</body>
</html>