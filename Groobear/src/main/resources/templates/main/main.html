<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/tiles}">
<head>
<meta charset="UTF-8">
<title>Groobear</title>
<script type="text/javascript"
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>


<style>
/* The switch - the box around the slider */
.switch {
	position: relative;
	display: inline-block;
	width: 60px;
	height: 34px;
	vertical-align: middle;
}

/* Hide default HTML checkbox */
.switch input {
	display: none;
}

/* The slider */
.slider {
	position: absolute;
	cursor: pointer;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background-color: #ccc;
	-webkit-transition: .4s;
	transition: .4s;
}

.slider:before {
	position: absolute;
	content: "";
	height: 26px;
	width: 26px;
	left: 4px;
	bottom: 4px;
	background-color: white;
	-webkit-transition: .4s;
	transition: .4s;
}

input:checked+.slider {
	background-color: #2196F3;
}

input:focus+.slider {
	box-shadow: 0 0 1px #2196F3;
}

input:checked+.slider:before {
	-webkit-transform: translateX(26px);
	-ms-transform: translateX(26px);
	transform: translateX(26px);
}

/* Rounded sliders */
.slider.round {
	border-radius: 34px;
}

.slider.round:before {
	border-radius: 50%;
}

p {
	margin: 0px;
	display: inline-block;
	font-size: 15px;
	font-weight: bold;
}
</style>
</head>
<body layout:fragment="content">

	<p>
		<span class="sid" th:text="${session.Id}"></span>
	</p>
	<p>
		<span>[[${session.Name}]] hyunyong</span>
	</p>
	<p>
		<span th:text="${session.Pno}"></span>
	</p>
	<a href="/proMain">프로젝트</a>
	<span onclick="openChat()">실시간대화</span>
	<div class="work">
		
	</div>	

	<!-- 출근/퇴근 스위치 -->
<div id="workSwitch">
	<label class="switch"> 
		<input class="chkBox" type="checkbox">
		<span class="slider round cBtn"></span>
	</label>
	<!-- <p class="noWork">퇴근</p>
	<p class="work">출근</p> -->
</div>

<!-- 연장근무 시작/종료 스위치 -->
<div id="overWorkSwitch">
	<label class="switch"> 
		<input class="chkBoxo" type="checkbox">
		<span class="slider round cBtno"></span>
	</label>
	<!-- <p class="noOverWork">연장근무 종료</p>
	<p class="overWork" style="display: none;">연장근무 시작</p> -->
</div>

<!-- 데이터 -->
<p class="day" style="display:none;"></p>
<p class="startWork" style="display:none;"></p>
<p class="endWork" style="display:none;"></p>
<p class="startOverWork" style="display:none;"></p>
<p class="endOverWork" style="display:none;"></p>



<script>
var openChat  = function() {
	
 window.open("/roomList", "", "_blank");
}
</script>
	<script>
	let chkCount = 0;
	let chkCounto = 0;
	let id = document.querySelector('.sid').textContent;
	let sInfo = {
			'id' : id
	}
	console.log(id);
	init();
	function init(){
		console.log('11')
		fetch('getWork', {
			method:'POST',
			headers:{
				'content-Type' : 'application/json'	
			},
			body:JSON.stringify(sInfo)
		})
		.then(response => response.json())
		.then(data => {
			//console.log(data.day)
	        document.querySelector('.day').textContent = data.day;
	        document.querySelector('.startWork').textContent = data.workStart;
	        document.querySelector('.endWork').textContent = data.workEnd;
	        document.querySelector('.startOverWork').textContent = data.overWorkStart;
	        document.querySelector('.endOverWork').textContent = data.overWorkEnd;
	        updateSwitches(data);
	       	
	        
		})		
		.catch(err => {
			console.log(err);
		})		
		
		
		function updateSwitches(data) {
			let chkBox = document.querySelector('.chkBox');
			let chkBoxo = document.querySelector('.chkBoxo');
			let work = document.querySelector('.work');
			let noWork = document.querySelector('.noWork');
			let onBtno = document.querySelector('.onBtno');

			// 출근/퇴근 스위치 업데이트
			console.log(data.workStart);
			console.log(data.workEnd);
			console.log(data.overWorkStart);
			console.log(chkBox.checked);
			if (data.workStart != null && data.workEnd == null) {
				chkBox.checked = true;
				if(chkBox.checked = true){
					let p = document.createElement('p');
					p.innerText = '출근';
					document.querySelector('#workSwitch').append(p);
				}
			} else if(data.workEnd != null || data.workStart == null){
				chkBox.checked = false;
					let p = document.createElement('p');
					p.innerText = '퇴근';
					document.querySelector('#workSwitch').append(p);
			}
			
			// 연장근무 시작/종료 스위치 업데이트
			if (data.overWorkStart != null && data.overWorkEnd == null) {
				chkBoxo.checked = true;
				let p = document.createElement('p');
				p.innerText = '연장근무 시작';
				document.querySelector('#overWorkSwitch').append(p);
			} else if(data.overWorkEnd != null || data.overWorkStart == null){
				chkBoxo.checked = false;
				let p = document.createElement('p');
				p.innerText = '연장근무 종료';
				document.querySelector('#overWorkSwitch').append(p);
			}

			/* document.querySelector('.day').textContent = data.day;
	        document.querySelector('.startWork').textContent = data.workStart;
	        document.querySelector('.endWork').textContent = data.workEnd;
	        document.querySelector('.startOverWork').textContent = data.overWorkStart;
	        document.querySelector('.endOverWork').textContent = data.overWorkEnd; */
		
	        let check = document.querySelector('.cBtn');
			let ocheck = document.querySelector('.cBtno');

			
			 if (document.querySelector('.startWork').textContent != '') {
					chkCount = 1;
				}
				if (document.querySelector('.endWork').textContent != '') {
					chkCount = 2;
				}
				let chkCounto = 0;
				if (document.querySelector('.startOverWork').textContent != '') {
					chkCounto = 1;
				}
				if (document.querySelector('.endOverWork').textContent != '') {
					chkCounto = 2;
				}
			
			
			
			console.log(chkCount);
			console.log(chkCounto);
			
			
			console.log(document.querySelector('.startWork').textContent != '');
			// 출근/퇴근 스위치 클릭 이벤트 핸들러
			check.addEventListener('click', function () {
				
				let chk = document.querySelector('.chkBox').checked;
				if (chkCount < 2) {
					if (chk == false) {
						chkCount++;
						console.log(chkCount)
						chk = true;
							
						document.querySelector('#workSwitch').children[1].textContent = '출근';
						
						fetch("workStart", {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify(sInfo)
						})
							.then(response => response.json())
							.then(data => {
								console.log(data);
							})
							.catch(err => {
								console.log(err);
							});
					} else {
						chkCount++;
						console.log(chkCount)
						chk = false;
						
						document.querySelector('#workSwitch').children[1].textContent = '퇴근';
						
						fetch("workEnd", {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify(sInfo)
						})
							.then(response => response.json())
							.then(data => {
								console.log(data);
							})
							.catch(err => {
								console.log(err);
							});
					}
				} else {
					event.preventDefault();
				}
			});

			// 연장근무 시작/종료 스위치 클릭 이벤트 핸들러
			ocheck.addEventListener('click', function () {
				let chk = document.querySelector('.chkBoxo').checked;
				if(chkCount > 1){
				if (chkCounto < 2) {
					if (chk == false) {
						chkCounto++;
						console.log(chkCounto)
						chk = true;

						document.querySelector('#overWorkSwitch').children[1].textContent = '연장근무 시작';
						
						fetch("overWorkStart", {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify(sInfo)
						})
							.then(response => response.json())
							.then(data => {
								console.log(data);
							})
							.catch(err => {
								console.log(err);
							});
					} else {
						chkCounto++;
						console.log(chkCounto)
						chk = false;

						document.querySelector('#overWorkSwitch').children[1].textContent = '연장근무 종료';
						
						fetch("overWorkEnd", {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify(sInfo)
							})
						.then(response => response.json())
						.then(data => {
								console.log(data);
							})
							.catch(err => {
								console.log(err);
							});  
					}
				} else {
					event.preventDefault();
				}
				}else{
					event.preventDefault();
				}
			});
		
		
		
		
		
		
		
		
		
		
		
		
		}
	
		
		
		
		
		
		
		
		
		
	}
	
	
		
		
		
	
		
		
		
	</script>


</body>
</html>