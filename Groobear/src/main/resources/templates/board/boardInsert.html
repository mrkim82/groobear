<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
 layout:decorate="~{layout/boardTiles}">
<head>
    <meta charset="UTF-8">
    <title>Insert a new Board</title>
</head>
<body>
    <div layout:fragment="content">
        <h2>글 작성</h2>
        <form action="/boardInsert" method="post" role="form">
            <table>
                <tr>
                    <td>제목:</td>
                    <td><input type="text" id="title" name="title"  required /></td>
                </tr>
                <tr>
                    <td>내용:</td>
                    <td><textarea id="content" name="content" required></textarea></td>
                </tr>
                <tr>
                	<td>첨부파일:</td>
                	<td><input type="file" name="uploadFile" multiple/></td>
                </tr>
                <tr>
                    <td>작성자 ID:</td>
                    <td><input type="text" id="name" name="name" th:value="${session.Name}" readonly /></td>
                </tr>
                <tr>
                	<td style="display:none;"><input type="text" id="id" name="id" th:value="${session.Id}" readonly /></td>
               	</tr>
               	<tr>
               		<td><input type="hidden" id="boardType" name="boardType" th:value="${board.boardType}"></td>
               	</tr>
            </table>
            <button type="submit" >게시글 등록</button>
            <button id="listlist" type="button" th:onclick="|location.href='@{/boardList(boardType=${board.boardType})}'|" >목록으로</button>
        </form>
    <!-- <script th:inline="javascript">
    	function boardListGo() {
            let bT = /*[[${board.boardType}]]*/
            console.log()
            window.location.href ='boardList?boardType=' + bT
        }
    </script> -->
    
<script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
<script>
    $(document).ready(function(e){
        var formObj = $("form[role='form']"); 

        $("button[type='submit']").on("click", function(e){
            e.preventDefault();

            console.log("submit clicked");
        });
    });
    var regex = new RegExp("(.*?)\.(exe|sh|zip|alz)$");
    var maxSize = 5242880; //5MB
    function checkExtension(fileName, fileSize){
        if(fileSize > maxSize){
        alert("사이즈 초과");
        return false;
    }
    if(regex.test(fileName)){
        alert("해당 종류의 파일은 업로드 할 수 없습니다.");
        return false;
    }
    return true;
    }

    $("input[type='file']").change(function(e) {
        var formData = new FormData();
        var inputFile = $("input[name='uploadFile']");
        var files = inputFile[0].files;
        for(var i = 0; i< files.length; i++){
            if(!checkExtension(files[i].name, files[i].size)) {
                return false;
            }
            formData.append("uploadFile", files[i]);
        }
        $.ajax({
            url: '/uploadAjaxAction',
            processData: false,
            contentType: false,
            data : formData,
            type: 'POST',
            sucess : function(result) {
                console.log(result);
                showUploadResult(result);
            }
        }); //$.ajax
    });
    function showUploadResult(uploadResultArr) {
        if(!uploadResultArr || uploadResultArr.length == 0){
            return;
        }
        var uploadUL = $(".uploadResult ul");

        var str = "";

        $(uploadResultArr).each(function(i, obj) {
            //image type
            if(obj.image) {
                var fileCallPath = encodeURIComponent(obj.uploadPath + "/s_" + obj.uuid + "_" + obj.fileName);
                str += "<li><div>";
                str += "<span>" + obj.fileName + "</span>";
                str += "<button type='button' class='btn btn-warning btn='circle'><i class='fa fa-times'></i></button><br>";
                str += "<img src='/display?fileName="+fileCallPath+"'>";
                str += "</div>";
                str + "</li>";
            } else {
                var fileCallPath = encodeURIComponent( obj.uploadPath + "/" + obj.uuid +"_" + obj.fileName);
                var fileLink =  fileCallPath.replace(new RegExp(/\\/g), "/");

                str += "<li><div>";
                str += "<span>" + obj.fileName + "</span>";
                str += "<button type='button' class='btn btn-warning btn-circle'><i class='fa fa-times'></i></button><br>";
                str += "<img src='/resources/img/attach.png'></a>";
                str += "</div>";
                str + "</li>";
            }
        })
    }
    $(".uploadResult").on("click", "button", function(e) {
        console.log("delete file");
    });
    
</script>
</div>
</body>
</html>