<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
 layout:decorate="~{layout/tiles}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>

<body>
<div layout:fragment="content" >
	<table id="list">
		<thead>
			<tr>
				<td>글번호</td>
				<td>제목</td>
				<td>작성자</td>
				<td>작성일자</td>
				<td>조회수</td>
			</tr>
		</thead>
		<tbody id="bodyWash">
			<tr th:each="board, stat : ${boardList}" th:attr="onclick='window.location.href=\'/boardInfo?boardNo=' + ${board.boardNo} + '\''">
				<td>[[${board.boardNo}]]</td>
				<td>[[${board.title}]]</td>
				<td>[[${board.name}]]</td>
				<td th:text="${#dates.format(board.insertDate, 'yyyy.MM.dd')}"></td>
				<td>[[${board.count}]]</td>
				<td style="display:none;">[[${board.boardType}]]</td>
			</tr>
		</tbody>
	</table>
		<button type="button" id="write" onclick="location.href='boardInsert'">글쓰기</button>
		<select name="type">
			<option value='' selected>-- 선택 --</option>
			<option value='title'>제목</option>
			<option value='content'>내용</option>
			<option value='name'>작성자</option>
		</select>
		<input type="text" name="keyword" value=""/>
		<button type="button" id="searchBtn">검색</button>
		<button type="button" id="resetBtn" onclick=formInit()>초기화</button>
		
<script th:inline="javascript">
//초기화
function formInit() {
    let insertList = document.querySelectorAll('tbody > td');
    insertList.forEach(el => el.value = '');
}
//날짜포맷 맞춰주는 함수 
//https://carrotweb.tistory.com/160 참고사이트.
function SimpleDateTimeFormat(date, pattern) {
	var dateString = pattern.replace(/(yyyy|MM|dd|HH|mm|ss|SSS)/g, function(match) {
		var matchString = "";
		switch(match) {
			case "yyyy":
				matchString = date.getFullYear();
				break;
			case "MM":
				matchString = date.getMonth() + 1;
				break;
			case "dd":
				matchString = date.getDate();
				break;
			case "HH":
				matchString = date.getHours();
				break;
			case "mm":
				matchString = date.getMinutes();
				break;
			case "ss":
				matchString = date.getSeconds();
				break;
			case "SSS":
				matchString = date.getMilliseconds();
				break;
			default :
				matchString = match;
				break;
		}
		if (match == "SSS") {
			if (matchString < 10) {
				matchString = "00" + matchString;
			} else if (matchString < 100) {
				matchString = "0" + matchString;
			}
		} else {
			if ((typeof(matchString) == "number" && matchString < 10)) {
				matchString = "0" + matchString;
			}
		}
		return matchString;
	});

	return dateString;
}

const headers = ['boardNo','title','name','insertDate', 'count'];
    //검색버튼
    document.querySelector('#searchBtn')
       .addEventListener("click", searchBoardInfo);
    let boardType = /*[[${boardList[0].boardType}]]*/;
    

//검색
function searchBoardInfo(){
    document.querySelector('#bodyWash').replaceChildren();
    //let sTag = document.getElementById('search').value;
    let sTag = document.getElementsByName('type')[0].value;
    let kTag = document.getElementsByName('keyword')[0].value;
    let title ="";
    let name ="";
    let content ="";
    if(sTag == 'title'){
    	title = kTag;
    }else if(sTag == 'name'){
    	name = kTag;
    }else{
    	content = kTag;
    }
    fetch('http://localhost:8081/searchList', {
        method: "POST",
        headers : {
        	'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            "title" : title,
            "name" : name,
            "content" : content,
            "boardType" : boardType
        })
    })
    .then(response =>  response.json())
    .then(data => 
    {
        data.forEach(board => {
            let trTag = document.createElement('tr');
            let tdTag = document.createElement('td');
            
          for (let header of headers) {
                tdTag = document.createElement('td');
                if(header == 'insertDate'){
                    let myDate = board[header]
                    let date = new Date(myDate);
                    tdTag.textContent = SimpleDateTimeFormat(date, "yyyy.MM.dd");
                } else {
                	tdTag.textContent = board[header];
               	}
                trTag.append(tdTag);
            }
            trTag.append(tdTag);
            let table = document.querySelector('#list')
            table.append(trTag);
        })
    })
    .catch(reject => console.log(reject));
}
</script>
</div>
</body>
</html>
